<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orkus Task ‚Äî –ü—Ä–æ—Ñ–∏–ª—å</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; height: 100vh; overflow: hidden; background: #000; color: #fff; }
    #sky { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
    .container { position: relative; z-index: 10; padding: 20px; max-width: 600px; margin: 0 auto; }
    .card { background: rgba(255,255,255,0.08); backdrop-filter: blur(12px); border-radius: 20px; padding: 24px; margin: 16px 0; }
    h1 { font-size: 28px; margin-bottom: 16px; }
    .grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 12px; }
    .stat { text-align: center; }
    .stat-value { font-size: 24px; font-weight: bold; color: #2196F3; }
    .btn { display: block; width: 100%; padding: 14px; margin-top: 12px; border: none; border-radius: 14px; background: #2196F3; color: white; font-weight: 600; }
    .loading { text-align: center; padding: 40px; opacity: 0.7; }
  </style>
</head>
<body>
  <canvas id="sky"></canvas>
  <div class="container">
    <div id="content" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
  </div>

  <script>
    const canvas = document.getElementById('sky');
    const ctx = canvas.getContext('2d');
    let stars = [], clouds = [];

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      initStars(); initClouds();
    }

    function initStars() {
      stars = [];
      const n = Math.floor(canvas.width * canvas.height / 3000);
      for (let i = 0; i < n; i++) stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height * 0.8,
        r: Math.random() * 1.2 + 0.3,
        phase: Math.random() * Math.PI * 2
      });
    }

    function initClouds() {
      clouds = Array.from({length: 4}, (_, i) => ({
        x: -200 + i * 400 + Math.random() * 200,
        y: 80 + Math.random() * 120,
        w: 1 + Math.random() * 0.5
      }));
    }

    function getTime() {
      const now = new Date();
      const utc = now.getTime() + now.getTimezoneOffset() * 60000;
      const offset = Telegram.WebApp.initDataUnsafe?.user?.utc_offset || 10800;
      return new Date(utc + offset * 1000).getHours() + new Date(utc + offset * 1000).getMinutes() / 60;
    }

    function render() {
      const t = getTime();
      const w = canvas.width, h = canvas.height;

      // –§–æ–Ω
      const grad = ctx.createLinearGradient(0, 0, 0, h);
      if (t < 5.5 || t > 20.5) {
        grad.addColorStop(0, "#0c0c20"); grad.addColorStop(1, "#1a1a35");
      } else if (t >= 6.5 && t <= 19.5) {
        grad.addColorStop(0, "#87CEEB"); grad.addColorStop(1, "#E3F2FD");
      } else {
        const blend = t < 12 ? (t - 5.5) : (20.5 - t);
        const r = 11 + 124 * blend, g = 11 + 195 * blend, b = 29 + 206 * blend;
        grad.addColorStop(0, `rgb(${r},${g},${b})`);
        grad.addColorStop(1, `rgb(${29+221*blend},${40+200*blend},${61+194*blend})`);
      }
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, w, h);

      // –°–æ–ª–Ω—Ü–µ/–õ—É–Ω–∞
      const prog = Math.min(1, Math.max(0, (t - 5.5) / 15));
      const sunX = w * prog;
      const sunY = h * (0.25 + 0.2 * Math.sin(prog * Math.PI));

      if (t >= 5.5 && t <= 20.5) {
        const g = ctx.createRadialGradient(sunX, sunY, 0, sunX, sunY, 35);
        g.addColorStop(0, "#FFD54F"); g.addColorStop(1, "rgba(255,213,79,0.1)");
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(sunX, sunY, 35, 0, 2 * Math.PI); ctx.fill();
      } else {
        ctx.fillStyle = "#E0E0E0";
        ctx.beginPath(); ctx.arc(sunX, sunY, 22, 0, 2 * Math.PI); ctx.fill();
        ctx.fillStyle = "#B0B0C0";
        ctx.beginPath(); ctx.arc(sunX + 4, sunY - 4, 10, 0, 2 * Math.PI); ctx.fill();
      }

      // –ó–≤—ë–∑–¥—ã
      if (t < 6.5 || t > 19.5) {
        stars.forEach(s => {
          s.phase += 0.02;
          ctx.fillStyle = `rgba(255,255,255,${0.3 + 0.7 * Math.abs(Math.sin(s.phase))})`;
          ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, 2 * Math.PI); ctx.fill();
        });
      }

      // –û–±–ª–∞–∫–∞
      if (t >= 6 && t <= 20) {
        clouds.forEach(c => {
          c.x += 0.3;
          if (c.x > w + 200) c.x = -300;
          ctx.fillStyle = "rgba(255,255,255,0.92)";
          const s = c.w;
          ctx.beginPath();
          ctx.arc(c.x, c.y, 20 * s, 0, 2 * Math.PI);
          ctx.arc(c.x + 18 * s, c.y - 8 * s, 18 * s, 0, 2 * Math.PI);
          ctx.arc(c.x + 36 * s, c.y, 20 * s, 0, 2 * Math.PI);
          ctx.fill();
        });
      }

      requestAnimationFrame(render);
    }

    async function loadProfile() {
      try {
        const WebApp = window.Telegram.WebApp;
        WebApp.ready();
        WebApp.expand();

        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –±–æ—Ç–∞. –ü–æ–∫–∞ ‚Äî mock.
        const stats = { completed: 3, in_progress: 1, overdue: 0, earned: 4200 };
        const content = `
          <h1>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
          <div class="card">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="grid">
              <div class="stat"><div class="stat-value">${stats.completed}</div>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
              <div class="stat"><div class="stat-value">${stats.in_progress}</div>–í —Ä–∞–±–æ—Ç–µ</div>
              <div class="stat"><div class="stat-value" style="color:#FF5252">${stats.overdue}</div>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
              <div class="stat"><div class="stat-value">${stats.earned}</div>‚ÇΩ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
            </div>
          </div>
          <button class="btn" onclick="WebApp.openTelegramLink('https://t.me/Orkus4_bot')">üí¨ –ß–∞—Ç —Å –±–æ—Ç–æ–º</button>
        `;
        document.getElementById('content').innerHTML = content;
      } catch (e) {
        document.getElementById('content').innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${e.message}`;
      }
    }

    window.addEventListener('load', () => {
      resize();
      window.addEventListener('resize', resize);
      render();
      setTimeout(loadProfile, 500);
    });
  </script>
</body>
</html>
