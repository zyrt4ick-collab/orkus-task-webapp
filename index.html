<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>0rkUS Task ‚Äî Eclipse Edition</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/ru.js"></script>
  <style>
    :root {
      --bg: #000;
      --surface: rgba(25,0,0,0.85);
      --border: #4a0000;
      --text: #ffdddd;
      --accent: #c41e3a;
      --glow: rgba(196,30,58,0.65);
      --blood: #8b0000;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Arial Black', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      padding: 16px 0 90px;
      touch-action: manipulation;
      cursor: url('https://www.nicepng.com/png/detail/74-745371_mouse-pointer-clip-art-at-clker-red-mouse.png') 0 0, auto !important;
    }
    a, button, .nav-item, .task-card, [onclick], .clickable {
      cursor: url('https://www.nicepng.com/png/detail/435-4352183_red-pointer-png-www-pixshark-com-images-galleries.png') 15 5, pointer !important;
    }
    body::before {
      content:''; position:fixed; inset:0; background-size:cover; background-position:center; opacity:0.17;
      mix-blend-mode:screen; z-index:-2; animation:pulseBg 15s infinite alternate ease-in-out;
    }
    @media (pointer: fine) { body::before { background-image: url('https://i.pinimg.com/originals/2e/a4/c5/2ea4c503fe59f4d144d788d4f36f4840.gif'); } }
    @media (pointer: coarse) { body::before { background-image: url('https://i.pinimg.com/originals/17/ae/06/17ae06540511b52c13de5dbf8740319f.gif'); } }
    @keyframes pulseBg { 0%{opacity:0.14;transform:scale(1)} 50%{opacity:0.24;transform:scale(1.04)} 100%{opacity:0.17;transform:scale(1.02)} }

    .blood-particles { position:fixed; inset:0; pointer-events:none; z-index:-1; }
    .particle { position:absolute; background:var(--blood); border-radius:50%; box-shadow:0 0 18px var(--blood); animation:bloodDrip 7s infinite linear; opacity:0; }
    @keyframes bloodDrip { 0%{transform:translateY(-100vh) scale(0.4);opacity:0.7} 50%{opacity:1} 100%{transform:translateY(100vh) scale(1.3);opacity:0} }

    .glass { background:var(--surface); backdrop-filter:blur(14px); border:1px solid var(--border); border-radius:16px; padding:1.6rem; box-shadow:0 10px 40px rgba(0,0,0,0.75); transition:0.25s; }
    .glass:hover { transform:translateY(-6px) scale(1.02); box-shadow:0 16px 55px var(--glow); }

    header { padding:2.2rem 1rem 1.2rem; text-align:center; }
    .greeting { font-size:2.4rem; font-weight:900; color:var(--accent); text-shadow:0 0 20px var(--glow); }
    #berserk-quote { font-size:1.05rem; font-style:italic; opacity:0.85; transition:opacity 1s; margin:1rem 0; }

    .nav-bar { position:fixed; bottom:0; left:0; right:0; background:rgba(8,0,0,0.94); backdrop-filter:blur(14px); border-top:1px solid var(--border); padding:8px; display:flex; justify-content:space-around; z-index:1000; flex-wrap:wrap; }
    .nav-item { color:#cc9999; font-size:0.75rem; text-align:center; min-width:60px; padding:6px 4px; border-radius:10px; transition:0.2s; }
    .nav-item.active { color:var(--accent); background:rgba(196,30,58,0.35); font-weight:bold; }

    .page { display:none; padding:1rem; }
    .page.active { display:block; }
    .section-title { font-size:1.6rem; color:var(--accent); margin:1.2rem 0 0.8rem; text-shadow:0 0 10px black; }

    .stats { display:grid; grid-template-columns:repeat(3,1fr); gap:1rem; margin-bottom:2rem; }
    .stat-card { background:var(--surface); border-radius:14px; padding:1.2rem; text-align:center; }
    .stat-value { font-size:2rem; color:var(--accent); font-weight:900; }

    .tasks-grid { display:grid; gap:1rem; }
    .task-card { background:var(--surface); border:2px solid var(--border); border-radius:14px; padding:1.4rem; transition:0.25s; }
    .task-card:active { transform:scale(0.97); border-color:var(--accent); }

    progress { width:100%; height:20px; background:var(--surface); border-radius:10px; margin:1rem 0; }
    progress::-webkit-progress-value { background:var(--accent); box-shadow:0 0 15px var(--glow); }

    #game-area { text-align:center; margin:2rem 0; }
    #race-canvas { border:2px solid var(--accent); background:#111; width:100%; height:180px; border-radius:12px; }
    button.game-btn { padding:12px 24px; font-size:1.1rem; margin:8px; background:var(--accent); border:none; color:white; border-radius:12px; box-shadow:0 0 15px var(--glow); }
  </style>
</head>
<body>
  <div class="blood-particles"></div>

  <header>
    <h1 class="greeting">–ü—Ä–∏–≤–µ—Ç, <span id="user-name">–í–æ–∏–Ω</span></h1>
    <div id="berserk-quote"></div>
  </header>

  <!-- 1. –ó–∞–¥–∞—á–∏ -->
  <div id="page-tasks" class="page active">
    <div class="section-title">–ó–∞–¥–∞—á–∏</div>
    <div class="stats">
      <div class="stat-card glass"><div class="stat-value" id="completed">0</div><div>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div></div>
      <div class="stat-card glass"><div class="stat-value" id="in-progress">0</div><div>–í —Ä–∞–±–æ—Ç–µ</div></div>
      <div class="stat-card glass"><div class="stat-value" id="earned">0 ‚ÇΩ</div><div>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div></div>
    </div>
    <div class="tasks-grid" id="tasks-list"></div>
  </div>

  <!-- 2. –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
  <div id="page-calendar" class="page">
    <div class="section-title">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</div>
    <div id="calendar"></div>
  </div>

  <!-- 3. –ü—Ä–æ—Ñ–∏–ª—å -->
  <div id="page-profile" class="page">
    <div class="section-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
    <div class="glass">
      <p>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
      <progress id="exp-bar" value="0" max="1000"></progress>
      <p>–û–ø—ã—Ç (‚ÇΩ): <span id="exp">0</span></p>
      <p>–ó–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: <span id="completed-profile">0</span></p>
      <p>–û—á–∫–∏ –∫—Ä–æ–≤–∏ (–∏–≥—Ä—ã): <span id="blood-points">0</span></p>
    </div>
  </div>

  <!-- 4. –ö–ª–∏–∫–µ—Ä (–æ—á–∫–∏ –∫—Ä–æ–≤–∏) -->
  <div id="page-clicker" class="page">
    <div class="section-title">–ö—Ä–æ–≤–∞–≤—ã–π –∫–ª–∏–∫–µ—Ä</div>
    <div class="glass" id="game-area">
      <h2>–ö–ª–∏–∫–Ω–∏ –ø–æ –±—Ä–µ–Ω–¥—É</h2>
      <div id="brand" style="font-size:8rem;cursor:pointer;user-select:none;">üî¥</div>
      <div style="font-size:1.8rem;margin:1rem 0;">–û—á–∫–∏ –∫—Ä–æ–≤–∏: <span id="clicker-points">0</span></div>
      <button class="game-btn" onclick="upgradeAuto()">–ê–≤—Ç–æ–∫–ª–∏–∫ (+1/—Å–µ–∫) ‚Äî 50 –æ—á–∫–æ–≤</button>
      <p>–ê–≤—Ç–æ–∫–ª–∏–∫: <span id="auto-rate">0</span>/—Å–µ–∫</p>
    </div>
  </div>

  <!-- 5. –õ–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∫–∞ (—É–≥–∞–¥–∞–π —á–∏—Å–ª–æ) -->
  <div id="page-logic" class="page">
    <div class="section-title">–õ–æ–≥–∏–∫–∞: –£–≥–∞–¥–∞–π –∫–æ–¥</div>
    <div class="glass">
      <p>–£–≥–∞–¥–∞–π 4-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (0-9, —Ü–∏—Ñ—Ä—ã –º–æ–≥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è). 8 –ø–æ–ø—ã—Ç–æ–∫.</p>
      <input id="guess-input" type="text" maxlength="4" placeholder="–í–≤–µ–¥–∏ 4 —Ü–∏—Ñ—Ä—ã" style="font-size:2rem;padding:10px;width:120px;text-align:center;">
      <button class="game-btn" onclick="checkGuess()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      <div id="guess-result" style="margin:1rem 0;min-height:120px;"></div>
      <p>–ü–æ–ø—ã—Ç–æ–∫ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="attempts-left">8</span></p>
    </div>
  </div>

  <!-- 6. –ì–æ–Ω–∫–∏ / –≤–æ–π–Ω–∞ -->
  <div id="page-race" class="page">
    <div class="section-title">–ì–æ–Ω–∫–∏ –≤–æ–∏–Ω–æ–≤</div>
    <div class="glass">
      <canvas id="race-canvas"></canvas>
      <p>–ö–ª–∏–∫–∞–π —á—Ç–æ–±—ã –±–µ–∂–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ! –ö—Ç–æ –ø–µ—Ä–≤—ã–π –¥–æ–±–µ–∂–∏—Ç ‚Äî +50 –æ—á–∫–æ–≤ –∫—Ä–æ–≤–∏</p>
      <button class="game-btn" onclick="raceBoost()">–ë–µ–∂–∞—Ç—å! ‚ö°</button>
      <p>–¢–≤–æ—è —Å–∫–æ—Ä–æ—Å—Ç—å: <span id="player-speed">1</span> | –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: <span id="enemy-speed">1</span></p>
      <p id="race-status">–ì–æ–Ω–∫–∞ –Ω–∞—á–Ω—ë—Ç—Å—è –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞</p>
    </div>
  </div>

  <nav class="nav-bar">
    <div class="nav-item active" onclick="showPage('tasks')"><span class="emoji">‚öîÔ∏è</span>–ó–∞–¥–∞—á–∏</div>
    <div class="nav-item" onclick="showPage('calendar')"><span class="emoji">üìÖ</span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</div>
    <div class="nav-item" onclick="showPage('profile')"><span class="emoji">üõ°Ô∏è</span>–ü—Ä–æ—Ñ–∏–ª—å</div>
    <div class="nav-item" onclick="showPage('clicker')"><span class="emoji">üî¥</span>–ö–ª–∏–∫–µ—Ä</div>
    <div class="nav-item" onclick="showPage('logic')"><span class="emoji">üß†</span>–õ–æ–≥–∏–∫–∞</div>
    <div class="nav-item" onclick="showPage('race')"><span class="emoji">üèÉ</span>–ì–æ–Ω–∫–∏</div>
  </nav>

  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // –ö—Ä–æ–≤—å
    for(let i=0;i<60;i++){
      const p=document.createElement('div');
      p.className='particle';
      p.style.left=Math.random()*100+'%';
      p.style.width=p.style.height=(Math.random()*7+3)+'px';
      p.style.animationDelay=Math.random()*8+'s';
      document.querySelector('.blood-particles').appendChild(p);
    }

    // –¶–∏—Ç–∞—Ç—ã
    const quotes = ["–Ø –Ω–µ –ø–æ–∑–≤–æ–ª—é —Ç–µ–±–µ —Å–ª–æ–º–∞—Ç—å –º–µ–Ω—è, –ì—Ä–∏—Ñ—Ñ–∏—Ç.","–î–∞–∂–µ –µ—Å–ª–∏ –≤–µ—Å—å –º–∏—Ä –±—É–¥–µ—Ç –ø—Ä–æ—Ç–∏–≤ –º–µ–Ω—è‚Ä¶","–Ø –±—É–¥—É —Å—Ä–∞–∂–∞—Ç—å—Å—è.","–°—Ç—Ä–∞–¥–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫–∞ —á–µ–ª–æ–≤–µ–∫–æ–º.","–ú–µ—á ‚Äî —ç—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä—É–∫–∏.","–Ø –Ω–µ –≥–µ—Ä–æ–π‚Ä¶ –Ø –ø—Ä–æ—Å—Ç–æ —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–¥–∞–≤–∞—Ç—å—Å—è."];
    function showQuote(){ const q=quotes[Math.floor(Math.random()*quotes.length)]; const el=document.getElementById('berserk-quote'); el.style.opacity=0; setTimeout(()=>{el.textContent=q;el.style.opacity=0.85;},300); }
    setInterval(showQuote,20000); showQuote();

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    function showPage(id){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById('page-'+id).classList.add('active');
      document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n=>{ if(n.getAttribute('onclick')===`showPage('${id}')`) n.classList.add('active'); });

      if(id==='calendar') initCalendar();
      if(id==='race') startRace();
      if(id==='logic') resetLogicGame();
    }

    // –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–æ—Ç–∞
    const user = Telegram.WebApp.initDataUnsafe.user || {};
    const uid = user.id || null;
    document.getElementById('user-name').textContent = user.first_name || '–í–æ–∏–Ω';

    let userStats = {completed:0, in_progress:0, earned:0};
    let bloodPoints = parseInt(localStorage.getItem('bloodPoints') || '0') || 0;

    async function loadUserData(){
      if(!uid) return;
      try{
        const res = await fetch(`/api/user?uid=${uid}`);
        userStats = await res.json();
        document.getElementById('completed').textContent = userStats.completed;
        document.getElementById('in-progress').textContent = userStats.in_progress;
        document.getElementById('earned').textContent = `${userStats.earned} ‚ÇΩ`;

        const level = 1 + Math.floor(userStats.earned / 1000);
        const progress = userStats.earned % 1000;
        document.getElementById('level').textContent = level;
        document.getElementById('exp-bar').value = progress;
        document.getElementById('exp').textContent = userStats.earned;
        document.getElementById('completed-profile').textContent = userStats.completed;
        document.getElementById('blood-points').textContent = bloodPoints;

        // –ó–∞–¥–∞—á–∏
        const tasksRes = await fetch(`/api/tasks?uid=${uid}`);
        const tasks = await tasksRes.json();
        const list = document.getElementById('tasks-list');
        list.innerHTML = tasks.length ? '' : '<div class="glass" style="padding:2rem;text-align:center;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>';
        tasks.forEach(t=>{
          const card = document.createElement('div');
          card.className='task-card glass';
          card.innerHTML = `<strong>${t.type}</strong>${t.from_lang ? `<p>–° ${t.from_lang} –Ω–∞ ${t.to_lang}</p>` : ''}<p>${t.description}</p><p>–ù–∞–≥—Ä–∞–¥–∞: ${t.executor_price} ‚ÇΩ</p><p>–î–µ–¥–ª–∞–π–Ω: ${t.deadline}</p>`;
          list.appendChild(card);
        });
      }catch(e){console.error(e);}
    }

    // –ö–∞–ª–µ–Ω–¥–∞—Ä—å
    function initCalendar(){
      if(window.calInit) return;
      const calEl = document.getElementById('calendar');
      new FullCalendar.Calendar(calEl, {
        initialView: 'dayGridMonth',
        locale: 'ru',
        height: 'auto'
      }).render();
      window.calInit = true;
    }

    // ‚îÄ‚îÄ‚îÄ –ö–ª–∏–∫–µ—Ä ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let autoClickRate = 0;
    let clickerPoints = 0;

    document.getElementById('brand').addEventListener('click', () => {
      clickerPoints += 1 + Math.floor(clickerPoints / 200);
      bloodPoints += 1;
      document.getElementById('clicker-points').textContent = clickerPoints;
      document.getElementById('blood-points').textContent = bloodPoints;
      localStorage.setItem('bloodPoints', bloodPoints);
    });

    function upgradeAuto(){
      if(bloodPoints >= 50){
        bloodPoints -= 50;
        autoClickRate += 1;
        document.getElementById('auto-rate').textContent = autoClickRate;
        document.getElementById('blood-points').textContent = bloodPoints;
        localStorage.setItem('bloodPoints', bloodPoints);
      } else alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –∫—Ä–æ–≤–∏!");
    }

    setInterval(() => {
      if(autoClickRate > 0){
        clickerPoints += autoClickRate;
        bloodPoints += autoClickRate;
        document.getElementById('clicker-points').textContent = clickerPoints;
        document.getElementById('blood-points').textContent = bloodPoints;
        localStorage.setItem('bloodPoints', bloodPoints);
      }
    }, 1000);

    // ‚îÄ‚îÄ‚îÄ –õ–æ–≥–∏–∫–∞ (—É–≥–∞–¥–∞–π —á–∏—Å–ª–æ) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let secretCode, attemptsLeft;

    function resetLogicGame(){
      secretCode = Array(4).fill(0).map(()=>Math.floor(Math.random()*10)).join('');
      attemptsLeft = 8;
      document.getElementById('guess-result').innerHTML = '';
      document.getElementById('attempts-left').textContent = attemptsLeft;
      document.getElementById('guess-input').value = '';
    }

    function checkGuess(){
      const guess = document.getElementById('guess-input').value.trim();
      if(guess.length !== 4 || !/^\d{4}$/.test(guess)) return alert("–í–≤–µ–¥–∏ —Ä–æ–≤–Ω–æ 4 —Ü–∏—Ñ—Ä—ã!");

      attemptsLeft--;
      document.getElementById('attempts-left').textContent = attemptsLeft;

      let bulls = 0, cows = 0;
      for(let i=0; i<4; i++){
        if(guess[i] === secretCode[i]) bulls++;
        else if(secretCode.includes(guess[i])) cows++;
      }

      const res = document.createElement('div');
      res.textContent = `${guess} ‚Üí ${bulls} –±—ã–∫–æ–≤, ${cows} –∫–æ—Ä–æ–≤`;
      document.getElementById('guess-result').prepend(res);

      if(bulls === 4){
        document.getElementById('guess-result').innerHTML += '<div style="color:#0f0;font-size:1.4rem;">–ü–æ–±–µ–¥–∞! +100 –æ—á–∫–æ–≤ –∫—Ä–æ–≤–∏</div>';
        bloodPoints += 100;
        document.getElementById('blood-points').textContent = bloodPoints;
        localStorage.setItem('bloodPoints', bloodPoints);
        resetLogicGame();
      } else if(attemptsLeft <= 0){
        document.getElementById('guess-result').innerHTML += `<div style="color:#f33;">–ü—Ä–æ–∏–≥—Ä—ã—à. –ö–æ–¥ –±—ã–ª: ${secretCode}</div>`;
        resetLogicGame();
      }

      document.getElementById('guess-input').value = '';
    }

    // ‚îÄ‚îÄ‚îÄ –ì–æ–Ω–∫–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let raceRunning = false, playerPos = 0, enemyPos = 0, playerSpeed = 1, enemySpeed = 1.1;
    const canvas = document.getElementById('race-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.offsetWidth;

    function drawRace(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // –§–∏–Ω–∏—à
      ctx.fillStyle = '#444'; ctx.fillRect(canvas.width-40,0,40,canvas.height);
      ctx.fillStyle = '#fff'; ctx.font = '20px Arial'; ctx.fillText('–§–ò–ù–ò–®', canvas.width-35, canvas.height/2);

      // –ò–≥—Ä–æ–∫
      ctx.fillStyle = '#c41e3a'; ctx.fillRect(playerPos, 60, 40, 60);
      ctx.fillStyle = '#fff'; ctx.fillText('–¢–´', playerPos+5, 100);

      // –í—Ä–∞–≥
      ctx.fillStyle = '#555'; ctx.fillRect(enemyPos, 120, 40, 60);
      ctx.fillStyle = '#aaa'; ctx.fillText('–ì–†–ò–§–§–ò–¢', enemyPos+5, 160);
    }

    function raceLoop(){
      if(!raceRunning) return;
      playerPos += playerSpeed * 2;
      enemyPos += enemySpeed * 2;
      drawRace();

      if(playerPos >= canvas.width - 80){
        raceRunning = false;
        document.getElementById('race-status').textContent = '–¢—ã –ø–æ–±–µ–¥–∏–ª! +50 –æ—á–∫–æ–≤ –∫—Ä–æ–≤–∏';
        bloodPoints += 50;
        document.getElementById('blood-points').textContent = bloodPoints;
        localStorage.setItem('bloodPoints', bloodPoints);
      } else if(enemyPos >= canvas.width - 80){
        raceRunning = false;
        document.getElementById('race-status').textContent = '–ì—Ä–∏—Ñ—Ñ–∏—Ç –ø–æ–±–µ–¥–∏–ª...';
      } else {
        requestAnimationFrame(raceLoop);
      }
    }

    function startRace(){
      playerPos = 0; enemyPos = 0; playerSpeed = 1; enemySpeed = 1.1;
      raceRunning = true;
      document.getElementById('race-status').textContent = '–ì–æ–Ω–∫–∞ –∏–¥—ë—Ç...';
      drawRace();
      raceLoop();
    }

    function raceBoost(){
      if(raceRunning) playerSpeed += 0.4;
      document.getElementById('player-speed').textContent = playerSpeed.toFixed(1);
    }

    loadUserData();
  </script>
</body>
</html>
